/**
 * Search Service - 4 Entitï¿½s
 */


application {
  config {
    baseName searchService
    applicationType microservice
    packageName fr.smartprod.paperdms.search
    authenticationType jwt
    databaseType sql
    devDatabaseType postgresql
    prodDatabaseType postgresql
    serverPort 8083
    cacheProvider redis
    buildTool maven
    enableSwaggerCodegen true
    messageBroker kafka
    searchEngine elasticsearch
    serviceDiscoveryType consul
  }
  entities SearchIndex, SearchQuery, SearchSemantic, SearchFacet
}
// Enums
enum FacetType {
  TERMS, DATE_RANGE, NUMBER_RANGE, HIERARCHY, NESTED
}

entity SearchIndex {
  documentSha256 String required maxlength(64)
  indexedContent TextBlob required
  metadata TextBlob
  tags String maxlength(2000)
  correspondents String maxlength(1000)
  extractedEntities TextBlob
  indexedDate Instant required
  lastUpdated Instant
}

entity SearchQuery {
  query String required maxlength(1000)
  filters TextBlob
  resultCount Integer
  executionTime Long
  userId String maxlength(50)
  searchDate Instant required
  isRelevant Boolean
}

entity SearchSemantic {
  query String required maxlength(1000)
  queryEmbedding TextBlob required
  results TextBlob required
  relevanceScores TextBlob
  modelUsed String maxlength(100)
  executionTime Long
  userId String maxlength(50)
  searchDate Instant required
}

entity SearchFacet {
  
  facetName String required maxlength(100)
  facetType FacetType required
  values TextBlob required
  counts TextBlob required
}

// Relations
relationship OneToMany {
  SearchQuery{facets} to SearchFacet{searchQuery}
}
 

microservice SearchIndex, SearchQuery, SearchSemantic, SearchFacet with searchService